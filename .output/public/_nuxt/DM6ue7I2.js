import{N as u,L as i,u as p,aJ as n,H as h,U as f}from"./B10uIJow.js";const c={projects:"/api/ipin/v1/pins",proposals:"/api/ipin/v1/bids"},y=u("projects",{state:()=>({projects:[],pagination:{total:0,lastPage:1,perPage:12,currentPage:0},selected:null,filters:{order:{field:"id",way:"desc"}},loading:!1}),getters:{},actions:{setFilters(e){typeof e.search=="string"&&(this.filters.search=e.search??void 0),typeof e.minPrice=="number"&&typeof e.maxPrice=="number"&&(this.filters.priceRange={from:e.minPrice>0?e.minPrice:0,to:e.maxPrice>0?e.maxPrice:1e12}),Array.isArray(e.categories)&&(this.filters.categories=e.categories.length>0?e.categories:void 0)},async get(e,a=10){try{this.loading=!0;const s=await i.get(c.projects,{page:e,take:a,include:"categories",filter:JSON.stringify(this.filters)}),r=s.meta;this.projects=s.data,this.pagination=r.page}catch(s){throw console.error(s),s}finally{this.loading=!1}},async create(e){var o;const a=p();if(!a.user)throw n.create({message:"Debes Ingresar para poder crear un proyecto",type:"negative"}),new Error("you need be logged");const s=e.files;if(delete e.files,e={...e,user_id:a.user.id,country_id:48,province_id:721,city_id:956,status:2},s&&s.length>0){e.medias_multi={documents:{files:[]}};for(let t=0;t<s.length;t++){const l=s[t],d=new FormData;d.append("disk","s3"),d.append("parent_id","0"),d.append("file",l);const{data:g}=await i.post("/api/imedia/v1/files",d,!1);(o=e.medias_multi.documents)==null||o.files.push(g.id)}}const r=await i.post(c.projects,{attributes:e});return this.get(1),h.redirectTo("/projects"),r},async viewDetails(e){try{const a={order:{field:"id",way:"desc"},ad_id:e};this.loading=!0;const s=await i.get(`${c.projects}/${e}`,{include:"categories,user,province,country,city"}),r=await i.get(`${c.proposals}`,{filter:JSON.stringify(a),include:"creator.ratings"}),o=s.data;o.bids=r.data.map(t=>(t.creator&&(t.creator=new f(t.creator)),t)),this.selected=o,h.redirectTo(`/projects/${e}`)}catch(a){throw console.error(a),a}finally{this.loading=!1}},removeSelected(){this.selected=null},async addProposal(e){var s;if(!p().user)throw n.create({message:"Debes Ingresar para poder crear una propuesta",type:"negative"}),new Error("you need be logged");try{const r=e.files;if(delete e.files,r&&r.length>0){e.medias_multi={documents:{files:[]}};for(let t=0;t<r.length;t++){const{data:l}=await i.fileUpload(r[t]);(s=e.medias_multi.documents)==null||s.files.push(l.id)}}const o=await i.post(c.proposals,{attributes:e});if(this.selected&&this.selected.id===e.ad_id){const t=this.selected.bids??[];t.unshift(o.data),this.selected.bids=t}n.create({message:"Se ha enviado la propuesta exitosamente",type:"positive"}),console.log(o)}catch(r){throw console.error(r),r}},async selectProposal(e){const a=p();if(!a.user)throw n.create({message:"Debes Ingresar para poder crear una propuesta",type:"negative"}),new Error("you need be logged");if(!this.selected||this.selected.createdBy!==a.user.id)throw new Error("you need to select a project that you create");try{const s=await i.put(c.proposals+`/${e.id}`,{"attributes[selected]":1});n.create({message:"Se ha seleccionado la propuesta exitosamente",type:"positive"}),this.viewDetails(this.selected.id)}catch(s){throw console.error(s),s}}}});export{y as u};
